<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kanban Board</title>
    <script src="webui.js"></script>
    <script src="backendproxy.js"></script>
    <style>
      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", sans-serif;
        background-color: #f8fafc;
        color: #0f172a;
        min-height: 100vh;
        padding: 2rem;
      }

      h1 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 2rem;
        color: #0f172a;
        letter-spacing: -0.025em;
      }

      #board {
        display: flex;
        gap: 1.5rem;
        align-items: flex-start;
      }

      .column {
        background-color: #f1f5f9;
        border-radius: 0.75rem;
        padding: 1rem;
        min-width: 260px;
        max-width: 300px;
        flex-shrink: 0;
      }

      .column-header {
        font-size: 0.875rem;
        font-weight: 600;
        color: #475569;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
      }

      .column-divider {
        border: none;
        border-top: 2px solid #cbd5e1;
        margin-bottom: 1rem;
      }

      .cards {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .card {
        background-color: #ffffff;
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
        color: #1e293b;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }

      .card:hover {
        border-color: #94a3b8;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      }

      .error {
        color: #ef4444;
        font-size: 0.875rem;
      }
    </style>
  </head>
  <body>
    <h1>Kanban Board</h1>
    <div id="board">Lade Board...</div>

    <script>
      const backend = new BackendProxy();

      async function renderBoard() {
        const boardEl = document.getElementById("board");
        try {
          boardEl.textContent = "Verbinde...";
          const board = await backend.getBoard();
          boardEl.innerHTML = "";

          for (const column of board.columns) {
            const colEl = document.createElement("div");
            colEl.className = "column";

            const header = document.createElement("div");
            header.className = "column-header";
            header.textContent = column.name;
            colEl.appendChild(header);

            const divider = document.createElement("hr");
            divider.className = "column-divider";
            colEl.appendChild(divider);

            const cardsEl = document.createElement("div");
            cardsEl.className = "cards";

            for (const card of column.cards) {
              const cardEl = document.createElement("div");
              cardEl.className = "card";
              cardEl.textContent = card.title;
              cardsEl.appendChild(cardEl);
            }

            colEl.appendChild(cardsEl);
            boardEl.appendChild(colEl);
          }
        } catch (err) {
          const message = err instanceof Error
            ? err.message
            : String(err);
          boardEl.innerHTML =
            `<span class="error">Fehler beim Laden: ${message}</span>`;
        }
      }

      window.addEventListener("load", async () => {
        try {
          await backend.waitReady();
          await renderBoard();
        } catch (err) {
          const boardEl = document.getElementById("board");
          const message = err instanceof Error
            ? err.message
            : String(err);
          boardEl.innerHTML =
            `<span class="error">Fehler beim Verbinden: ${message}</span>`;
        }
      });
    </script>
  </body>
</html>
